{% extends 'base.html' %}
{% load humanize %}

{% block content %}

    <div class="container py-5">
      <div class="row product-card">
        <div class="col-md-5 p-3">
          <img src="{{ product.picture.url }}" class="product-image" alt="{{ product.name }}">
        </div>
        <div class="col-md-7 p-4">
          <h1 class="product-title mb-3">{{ product.name }}</h1>
          <p class="text-muted mb-4">{{ product.description }}</p>

          <h5 class="mb-2">ویژگی‌ها:</h5>
          <ul class="mb-4">
            {% for feature in product.features.all %}
              <li><strong>{{ feature.title }}:</strong> {{ feature.value }}</li>
            {% empty %}
              <li>ویژگی‌ای ثبت نشده است.</li>
            {% endfor %}
          </ul>

          <div class="mb-4">
            {% if product.is_sale %}
              <span class="price-old">{{ product.price|intcomma }} تومان</span>
              <span class="price-new">{{ product.sale_price|intcomma }} تومان</span>
            {% else %}
              <span class="price-new">{{ product.price|intcomma }} تومان</span>
            {% endif %}
          </div>

          <div class="mb-4">
            <label for="cart-qty" class="form-label">تعداد</label>
            <select class="form-select w-25 d-inline" id="cart-qty">
              <option selected disabled>انتخاب کنید</option>
              {% for i in "1234" %}
                <option value="{{ i }}">{{ i }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="d-flex gap-2">
            <button class="btn btn-buy px-4" type="button" value="{{ product.id }}" id="add-cart">
              افزودن به سبد خرید
            </button>
            <a href="{% url 'home' %}" class="btn btn-outline-secondary">بازگشت به صفحه اصلی</a>
          </div>
        </div>
      </div>
    </div>

    <script>
      $(document).on('click', '#add-cart', function(e){
        e.preventDefault();
        $.ajax({
          type: 'POST',
          url: '{% url "cart_add" %}',
          data:{
            product_id: $('#add-cart').val(),
            product_qty : $('#cart-qty option:selected').text(),
            csrfmiddlewaretoken: '{{ csrf_token }}',
            action : 'post'
          },
          success: function(json){
            document.getElementById('cart_quantity').textContent = json.qty;
            location.reload();
          },
          error: function(xhr, errmsg, err){
           
          }
        });
      });
    </script>
{% endblock %}
