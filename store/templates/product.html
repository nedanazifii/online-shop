{% extends 'base.html' %}
{% load humanize %}

{% block content %}

    <br><br><br><br><br>
        <div class="container">
            <div class="card mb-3" >
              <div class="row g-0">
                <div class="col-md-4">
                  <img src="{{ product.picture.url }}" class="img-fluid rounded-start" alt="...">
                </div>
                <div class="col-md-8">
                  <div class="card-body">
                    <h4 class="card-title">{{ product.name }}</h4><br>
                      <h6>توضیحات محصول: </h6>
                    <p class="card-text">{{ product.description }}</p>

                      {% if product.is_sale%}
                      <p class="card-text">
                          قیمت:<strike>{{ product.price |intcomma }}</strike><br>
                          {{ product.sale_price |intcomma }}
                      </p>
                      {% else %}
                        <p class="card-text">قیمت:{{ product.price |intcomma }}</p>
                      {% endif %}

                      <br>

                      <select class="form-select" id="cart-qty">
                          <option selected>تعداد</option>
                          <option value="1">1</option>
                          <option value="2">2</option>
                          <option value="3">3</option>
                          <option value="4">4</option>
                      </select>

                      <br><br><br>

                      <button class="btn btn-secondary" type="button" value="{{ product.id }}" id="add-cart">افزودن به سبد خرید</button>

                      <a href="{% url 'home' %}" class="btn btn-secondary"> بازگشت به صفحه اصلی</a>

                  </div>
                </div>
              </div>
            </div>
        </div>
    <br><br><br><br>
    <script>
        $(document).on('click', '#add-cart', function(e){
        e.preventDefault();
        $.ajax({
            type: 'POST',
            url: '{% url 'cart_add' %}',
            data:{
                product_id: $('#add-cart').val(),
                product_qty : $('#cart-qty option:selected').text(),
                csrfmiddlewaretoken: '{{ csrf_token }}',
                action : 'post'
            },
            success: function(json){
                document.getElementById('cart_quantity').textContent = json.qty
            },
            error:function(xhr, errmsg, err){
            }
        })
        })

    </script>

{% endblock %}